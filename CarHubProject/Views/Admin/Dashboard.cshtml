@model CarHubProject.ViewModels.DashboardViewModel
@{
    ViewData["Title"] = "Admin Dashboard";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <h1 class="display-4 mb-4">Admin Dashboard</h1>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-white bg-primary">
                <div class="card-body">
                    <h5 class="card-title">Total Cars</h5>
                    <h2 class="card-text">@Model.Cars.Count()</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-success">
                <div class="card-body">
                    <h5 class="card-title">Available Cars</h5>
                    <h2 class="card-text">@Model.Cars.Count(c => c.Status == "Available")</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-warning">
                <div class="card-body">
                    <h5 class="card-title">Rented Cars</h5>
                    <h2 class="card-text">@Model.Cars.Count(c => c.Status == "Rented")</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-info">
                <div class="card-body">
                    <h5 class="card-title">Total Contracts</h5>
                    <h2 class="card-text">@Model.Contracts.Count()</h2>
                </div>
            </div>
        </div>
    </div>

    <!-- Cars Table -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3>Cars Management</h3>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered">
                            <thead class="table-dark">
                                <tr>
                                    <th>ID</th>
                                    <th>Image</th>
                                    <th>Model</th>
                                    <th>Brand</th>
                                    <th>Year</th>
                                    <th>Price/Day</th>
                                    <th>Sale Price</th>
                                    <th>Status</th>
                                    <th>Fuel Type</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var car in Model.Cars)
                                {
                                    <tr>
                                        <td>@car.Id</td>
                                        <td>
                                            @if (!string.IsNullOrEmpty(car.ImageUrl))
                                            {
                                                <img src="@car.ImageUrl" alt="@car.Model" style="width: 80px; height: 60px; object-fit: cover;" />
                                            }
                                            else
                                            {
                                                <span class="text-muted">No Image</span>
                                            }
                                        </td>
                                        <td>@car.Model</td>
                                        <td>@car.Brand?.BrandName</td>
                                        <td>@car.Year</td>
                                        <td>@car.PricePerDay.ToString("C")</td>
                                        <td>@car.SalePrice.ToString("C")</td>
                                        <td>
                                            <span class="badge @GetStatusBadgeClass(car.Status)">@car.Status</span>
                                        </td>
                                        <td>@car.FuelType</td>
                                        <td>
                                            <div class="btn-group" role="group">
                                                <a asp-controller="Car" asp-action="Edit" asp-route-id="@car.Id" class="btn btn-sm btn-warning">Edit</a>
                                                <a asp-controller="Car" asp-action="Details" asp-route-id="@car.Id" class="btn btn-sm btn-info">Details</a>
                                                <form method="post" asp-action="UpdateCarStatus" class="d-inline">
                                                    <input type="hidden" name="carId" value="@car.Id" />
                                                    <select name="status" class="form-select form-select-sm" onchange="this.form.submit()">
                                                        <option value="Available" selected="@(car.Status == "Available")">Available</option>
                                                        <option value="Rented" selected="@(car.Status == "Rented")">Rented</option>
                                                        <option value="Maintenance" selected="@(car.Status == "Maintenance")">Maintenance</option>
                                                        <option value="Sold" selected="@(car.Status == "Sold")">Sold</option>
                                                    </select>
                                                </form>
                                            </div>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Contracts Table -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3>Rental Contracts</h3>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered">
                            <thead class="table-dark">
                                <tr>
                                    <th>Contract ID</th>
                                    <th>Type</th>
                                    <th>Car</th>
                                    <th>Start Date</th>
                                    <th>End Date</th>
                                    <th>Total Amount</th>
                                    <th>Payment Status</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var contract in Model.Contracts)
                                {
                                    var car = Model.Cars.FirstOrDefault(c => c.Id == contract.CarId);
                                    <tr>
                                        <td>@contract.ContractId</td>
                                        <td>
                                            <span class="badge @GetContractTypeBadgeClass(contract.ContractType)">@contract.ContractType</span>
                                        </td>
                                        <td>@car?.Model</td>
                                        <td>@contract.StartDate?.ToString("MM/dd/yyyy")</td>
                                        <td>@contract.EndDate?.ToString("MM/dd/yyyy")</td>
                                        <td>@contract.TotalAmount.ToString("C")</td>
                                        <td>
                                            <span class="badge @GetPaymentStatusBadgeClass(contract.PaymentStatus)">@contract.PaymentStatus</span>
                                        </td>
                                        <td>
                                            <span class="badge @GetContractStatusBadgeClass(contract.Status)">@contract.Status</span>
                                        </td>
                                        <td>
                                            <div class="btn-group" role="group">
                                                <a asp-controller="Contract" asp-action="Details" asp-route-id="@contract.ContractId" class="btn btn-sm btn-info">Details</a>
                                                <a asp-controller="Contract" asp-action="Edit" asp-route-id="@contract.ContractId" class="btn btn-sm btn-warning">Edit</a>
                                                <form method="post" asp-action="UpdateContractStatus" class="d-inline">
                                                    <input type="hidden" name="contractId" value="@contract.ContractId" />
                                                    <select name="status" class="form-select form-select-sm" onchange="this.form.submit()">
                                                        <option value="Pending" selected="@(contract.Status == "Pending")">Pending</option>
                                                        <option value="Active" selected="@(contract.Status == "Active")">Active</option>
                                                        <option value="Completed" selected="@(contract.Status == "Completed")">Completed</option>
                                                        <option value="Cancelled" selected="@(contract.Status == "Cancelled")">Cancelled</option>
                                                    </select>
                                                </form>
                                            </div>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@functions {
    private string GetStatusBadgeClass(string status)
    {
        return status switch
        {
            "Available" => "bg-success",
            "Rented" => "bg-warning",
            "Maintenance" => "bg-danger",
            "Sold" => "bg-secondary",
            _ => "bg-secondary"
        };
    }

    private string GetContractTypeBadgeClass(string contractType)
    {
        return contractType switch
        {
            "Rental" => "bg-primary",
            "Sale" => "bg-success",
            _ => "bg-secondary"
        };
    }

    private string GetPaymentStatusBadgeClass(string paymentStatus)
    {
        return paymentStatus switch
        {
            "Paid" => "bg-success",
            "Pending" => "bg-warning",
            "Overdue" => "bg-danger",
            _ => "bg-secondary"
        };
    }

    private string GetContractStatusBadgeClass(string contractStatus)
    {
        return contractStatus switch
        {
            "Active" => "bg-success",
            "Pending" => "bg-warning",
            "Completed" => "bg-info",
            "Cancelled" => "bg-danger",
            _ => "bg-secondary"
        };
    }
}